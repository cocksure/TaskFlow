{% load static %}
<!doctype html>

<html lang="en" data-bs-theme="light">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>{% block title %}TaskFlow{% endblock %}</title>

	<!-- Bootstrap 5 + Icons -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

	<link rel="stylesheet" href="{% static 'css/style.css' %}">


	<!-- HTMX -->
	<script src="https://unpkg.com/htmx.org@1.9.12"></script>

	<!-- SortableJS for drag & drop -->
	<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg tf-navbar sticky-top">
	<div class="container-fluid px-4">
		<!-- Logo -->
		<a class="navbar-brand tf-brand" href="{% url 'home' %}">
			<div class="brand-icon">
				<i class="bi bi-kanban"></i>
			</div>
			<span class="brand-text">TaskFlow</span>
		</a>

		{% if user.is_authenticated %}
		<!-- Navigation Pills -->
		<div class="nav-pills-container">
			<a href="{% url 'home' %}" class="nav-pill {% block nav_home %}{% endblock %}">
				<i class="bi bi-folder"></i>
				<span>Проекты</span>
			</a>
			<a href="{% url 'dashboard' %}" class="nav-pill {% block nav_dashboard %}{% endblock %}">
				<i class="bi bi-grid-1x2"></i>
				<span>Dashboard</span>
			</a>
		</div>

		<!-- Action Button -->
		<button class="nav-action-btn"
				hx-get="{% url 'project_create' %}"
				hx-target="#modalContent"
				hx-swap="innerHTML">
			<i class="bi bi-plus-lg"></i>
			<span class="d-none d-md-inline">Новый проект</span>
		</button>
		{% endif %}

		<!-- Right Side -->
		<div class="ms-auto d-flex align-items-center gap-2">
			<button class="nav-icon-btn" onclick="toggleTheme()" title="Сменить тему">
				<i class="bi bi-moon-fill" id="themeIcon"></i>
			</button>

			{% if user.is_authenticated %}
			<div class="dropdown">
				<button class="nav-user-btn" data-bs-toggle="dropdown">
					<div class="nav-user-avatar">{{ user.username.0|upper }}</div>
					<span class="nav-user-name d-none d-md-inline">{{ user.username }}</span>
					<i class="bi bi-chevron-down nav-user-chevron d-none d-md-inline"></i>
				</button>
				<ul class="dropdown-menu dropdown-menu-end">
					<li class="dropdown-header">
						<div class="d-flex align-items-center gap-2">
							<div class="dropdown-avatar">{{ user.username.0|upper }}</div>
							<div>
								<div class="fw-semibold">{{ user.username }}</div>
								<small class="text-muted">{{ user.email|default:"Пользователь" }}</small>
							</div>
						</div>
					</li>
					<li><hr class="dropdown-divider"></li>
					<li><a class="dropdown-item" href="{% url 'home' %}"><i class="bi bi-folder"></i>Мои проекты</a></li>
					<li><a class="dropdown-item" href="{% url 'dashboard' %}"><i class="bi bi-grid-1x2"></i>Dashboard</a></li>
					<li><hr class="dropdown-divider"></li>
					<li><a class="dropdown-item text-danger" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right"></i>Выйти</a></li>
				</ul>
			</div>
			{% endif %}
		</div>
	</div>
</nav>

<main class="main-content">
	{% block content %}{% endblock %}
</main>

<!-- Modal -->
<div class="modal fade" id="modal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content" id="modalContent"></div>
	</div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered modal-sm">
		<div class="modal-content">
			<div class="modal-body text-center py-4">
				<div class="delete-icon-wrapper mb-3">
					<i class="bi bi-trash text-danger" style="font-size: 2.5rem;"></i>
				</div>
				<h5 class="fw-semibold mb-2">Удалить задачу?</h5>
				<p class="text-muted small mb-0" id="deleteTaskName"></p>
			</div>
			<div class="modal-footer justify-content-center border-0 pt-0 pb-4">
				<button type="button" class="btn btn-tf-secondary" data-bs-dismiss="modal">Отмена</button>
				<button type="button" class="btn btn-danger px-4" id="confirmDeleteBtn">
					<i class="bi bi-trash me-1"></i>Удалить
				</button>
			</div>
		</div>
	</div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="{% static 'js/main.js' %}" defer></script>

{% block extra_js %}{% endblock %}
</body>
</html>